<!DOCTYPE html>
<html>

<head>
    <title>搜索结果页</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <meta name="referrer" content="no-referrer">
    <script src="https://cdn.staticfile.org/jquery/2.2.4/jquery.min.js"></script>

    <script src="https://unpkg.com/vue@3.3.8/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus@2.4.2/dist/index.css" />
    <script src="https://unpkg.com/element-plus@2.4.2/dist/index.full.js"></script>

    <script src="https://cdn.bootcdn.net/ajax/libs/blueimp-md5/2.18.0/js/md5.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
</head>

<body>
    <div id="app">
        <div class="r_box">
            <div class="search-lt">
                <div class="lt-item">
                    <div class="item_left">商品ID：</div>
                    <el-input placeholder="请输入要查询的商品ID" v-model.trim="queryData.goodsId"></el-input>
                </div>
            </div>

            <div class="search-rt">
                <el-button type="primary" @click="handleSearch">查询</el-button>
                <el-button type="primary" @click="handleRest">重置</el-button>
            </div>
        </div>

        <div class="s_box">
            <el-button type="primary" @click="exportExcel">批量导出</el-button>
        </div>

        <el-table :data="tableData" border style="width: 100%">
            <el-table-column prop="orderNo" label="订单号"></el-table-column>
            <el-table-column label="商品信息">
                <el-table-column label="商品名称">
                    <template #default="scope">
                        <div v-for="(info, index) in scope.row.goodsInfos" :key="index">
                            {{info.goodsName}}
                        </div>
                    </template>
                </el-table-column>
                <el-table-column label="商品数量">
                    <template #default="scope">
                        <div v-for="(info, index) in scope.row.goodsInfos" :key="index">
                            {{info.goodsNum}}
                        </div>
                    </template>
                </el-table-column>
            </el-table-column>

            <el-table-column prop="phone" label="手机号"></el-table-column>
        </el-table>

    </div>

    <script>
        // var httpApi = "https://newapi.aikbao.com";
        var httpApi = "https://testapi.aikbao.com";
        window.onload = function () {
            const app = Vue.createApp({
                name: 'App',
                setup() {
                    const data = {
                        tcTxt: Vue.ref("保存图片"),
                        list: Vue.ref([]),
                        queryData: Vue.reactive({
                            pageNo: 1,
                            pageSize: 20,
                            goodsId: '',
                        }),
                        tableData: [
                            {
                                "orderNo": "75044831100901123234334",
                                "goodsInfos": [
                                    {
                                        "goodsName": "优享团购1111",
                                        "goodsNum": 4
                                    },
                                    {
                                        "goodsName": "优享团购2222",
                                        "goodsNum": 2
                                    }
                                ],
                                "phone": "1369232329160",
                            },
                            {
                                "orderNo": "75044831100901123234334",
                                "goodsInfos": [
                                    {
                                        "goodsName": "优享团购3",
                                        "goodsNum": 4
                                    }
                                ],
                                "phone": "136902212320",
                            },
                            {
                                "orderNo": "75044831100901123234334",
                                "goodsInfos": [
                                    {
                                        "goodsName": "优享团购2",
                                        "goodsNum": 4
                                    }
                                ],
                                "phone": "13611111111",
                            },
                        ]
                    }


                    const methods = {
                        initData() {
                            $.ajax({
                                type: 'post',
                                url: httpApi + '/h5/robot/goods/search',
                                data: data.param,
                                async: true,
                            }).done(function (res) {
                                if (res.code == 200) {
                                    data.list.value = res.data
                                }
                            })
                                .fail(function (res) {

                                })
                        },

                        //获取参数
                        getUrlParam(name) {
                            var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)')
                            var paramName = window.location.search.substr(1).match(reg)
                            if (paramName != null) {
                                return decodeURIComponent(paramName[2]) //decodeURIComponent 处理中文乱码
                            }
                            return null
                        },

                        exportExcel() {
                            const data1 = data.tableData.map((item) => {
                                return {
                                    订单号: item.orderNo,
                                    商品信息: item.goodsInfos.map((info) => `${info.goodsName}(${info.goodsNum})`).join(', '),
                                    手机号: item.phone,
                                };
                            });

                            const ws = XLSX.utils.json_to_sheet(data1);
                            const wb = XLSX.utils.book_new();
                            XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
                            XLSX.writeFile(wb, '导出数据.xlsx');
                        },
                    }

                    Vue.onMounted(() => {
                        methods.initData()
                    });

                    return { ...data, ...methods }
                },
            })
            app.use(ElementPlus)

            app.mount('#app')
        }
    </script>

    <style>
        #app {
            max-width: 1200px;
            margin: 20px auto 0;
        }

        .r_box {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .search-lt {
            margin-right: 20px;
        }

        .lt-item {
            display: flex;
            align-items: center;
        }

        .item_left {
            flex-shrink: 0;
        }

        .s_box {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        }
    </style>
</body>

</html>